import React, { useMemo } from "react";
import { View, Text, StyleSheet } from "react-native";

import { spacing, typography, useAppTheme } from "@shared/theme";

type DocType = "terms" | "privacy";

interface Props {
  type: DocType;
  lastUpdated?: string;
}

type Section = {
  title: string;
  paragraphs?: string[];
  bullets?: string[];
};

const LAST_UPDATED_DEFAULT = "2025-10-24";

const TERMS_SECTIONS: Section[] = [
  {
    title: "第1条（適用）",
    paragraphs: [
      "本利用規約（以下「本規約」）は、kinyokuApp 運営チーム（以下「運営者」）が提供する禁欲継続支援アプリケーション「kinyokuApp」およびこれに付随する各種サービス（以下総称して「本サービス」）の利用条件を定めるものです。",
      "本サービスの利用者（以下「ユーザー」）は、本規約の全てに同意したうえで本サービスを利用するものとし、未成年者が利用する場合は親権者その他法定代理人の同意を得たものとみなします。",
    ],
  },
  {
    title: "第2条（定義）",
    paragraphs: [
      "本規約における主要な用語の意味は、次の各号のとおりとします。",
    ],
    bullets: [
      "「アカウント情報」：メールアドレス、パスワード、OAuth ログイン識別子等、ユーザーがログインするために登録する情報",
      "「プロフィール情報」：表示名、自己紹介、アバター画像、フォロー／ブロック状態等、ユーザーが任意に登録する情報",
      "「ユーザーコンテンツ」：日記、チャレンジ記録、コメント、チャット、画像、通知設定、メダル履歴等、本サービスにユーザーが投稿または蓄積する一切の情報",
      "「有料機能」：アプリ内課金、ペナルティ決済、トーナメント関連課金など、利用に料金が発生する機能",
      "「外部サービス」：Supabase、RevenueCat、Apple/Google の決済サービス、Expo、分析サービス等、運営者が本サービス提供のために利用する第三者サービス",
    ],
  },
  {
    title: "第3条（利用登録）",
    bullets: [
      "本サービスの利用を希望する者は、運営者の定める手続に従い、メールアドレス等の必要事項を登録するものとします。",
      "登録内容に虚偽、誤記、記入漏れがあった場合、または運営者が不適切と判断した場合、登録を拒否または抹消することがあります。",
      "登録事項に変更が生じた場合、ユーザーは遅滞なく運営者の指定する方法で変更手続を行うものとします。",
    ],
  },
  {
    title: "第4条（アカウント管理）",
    bullets: [
      "ユーザーは、アカウント情報を自己の責任で厳重に管理し、第三者に譲渡、貸与、共有等をしてはなりません。",
      "アカウント情報の管理不備、使用上の過誤、第三者による不正使用等によりユーザーに損害が生じても、運営者に故意または重大な過失がない限り責任を負いません。",
      "運営者は、不正アクセス、セキュリティリスク、長期未利用等を理由に、アカウントの利用停止または削除を行うことがあります。",
    ],
  },
  {
    title: "第5条（本サービスの内容）",
    paragraphs: [
      "本サービスは、禁欲・習慣改善の継続を支援することを目的として、主として以下の機能を提供します。",
      "本サービスは習慣改善を支援するツールであり、医療行為や専門的カウンセリングの提供を目的とするものではありません。健康状態や精神状態に不安がある場合は、必ず医療機関その他専門家に相談してください。",
    ],
    bullets: [
      "チャレンジの作成、継続日数・成功率の計測、ランキング・トーナメントの実施",
      "日記・コミュニティ投稿、コメント、リアクション、メッセージ機能を通じたユーザー間交流",
      "フォロー・ブロック管理、通知、リマインダー、カスタムペナルティ設定等の行動支援機能",
      "大会カード・プロフィールの表示、アバター管理、過去チャレンジ記録の閲覧",
      "有料機能（課金・ペナルティ支払い）を含む行動継続のための仕組み",
      "運営からのお知らせ、サポート対応、アンケート等の連絡",
    ],
  },
  {
    title: "第6条（料金および支払い）",
    bullets: [
      "本サービスの基本機能は無料で利用できますが、有料機能の利用には運営者またはプラットフォームが定める利用料が発生します。",
      "課金は Apple App Store、Google Play、RevenueCat 等の決済代行サービスを通じて行われ、各プラットフォームの利用規約・決済条件に従うものとします。",
      "課金完了後のキャンセル、返金、変更は、法令で定める場合または各プラットフォームの規約で認められている場合を除き対応いたしません。",
      "課金に関する領収書・請求書の発行可否は、各プラットフォームの仕様に従います。",
    ],
  },
  {
    title: "第7条（禁止事項）",
    paragraphs: [
      "ユーザーは、本サービスの利用に際し、次の各号の行為をしてはなりません。",
    ],
    bullets: [
      "法令、裁判所の判決・決定・命令、または行政機関による処分に違反する行為",
      "犯罪行為、犯罪予告、危険行為の助長、またはこれらにつながる行為",
      "公序良俗に反する情報、わいせつ・暴力的な表現、差別的・誹謗中傷的な表現の投稿",
      "自傷行為・依存行為・危険行為を助長する表現や、医療・法律などの専門的助言を装う虚偽情報の投稿",
      "他者の著作権、商標権、肖像権、プライバシー権その他の権利または利益を侵害する行為",
      "なりすまし、虚偽のプロフィールの作成、スパム投稿、広告・勧誘・アフィリエイト目的での利用",
      "本サービスのサーバーやネットワークに過度な負荷を与える行為、リバースエンジニアリング、解析、改変等の行為",
      "本サービスによって得た情報を無断で第三者に提供、開示、転用する行為",
      "運営者が提供する以外の方法で外部サービスの連携を操作する行為",
      "その他、運営者が不適切と合理的に判断する行為",
    ],
  },
  {
    title: "第8条（ユーザーコンテンツの取扱い）",
    bullets: [
      "ユーザーが投稿したコンテンツの著作権は原則として当該ユーザーに帰属します。ただし、ユーザーは運営者に対し、コンテンツを本サービスの提供、改善、広報、データ分析等の目的で無償かつ非独占的に利用（保存、複製、翻案、公衆送信等を含む）する権利を許諾するものとします。",
      "運営者は、ユーザーコンテンツが法令または本規約に違反すると判断した場合、事前の通知なく削除・非表示・編集等の措置を講じることができます。",
      "ユーザーは、コンテンツが第三者の権利を侵害しないことを保証し、紛争が生じた場合には自己の責任と費用で解決するものとします。",
    ],
  },
  {
    title: "第9条（利用停止・退会）",
    bullets: [
      "ユーザーは、アプリ上の手続に従っていつでも退会できます。退会後も、法令に基づき保存が必要な情報や、他ユーザーとの共同コンテンツは一定期間保持される場合があります。",
      "運営者は、ユーザーが本規約に違反したと合理的に判断した場合、事前通知なくアカウントの停止、削除、利用制限その他必要な措置を講じることができます。",
      "アカウント停止中は、本サービスの全部または一部の機能を利用できません。",
    ],
  },
  {
    title: "第10条（サービスの変更・提供停止）",
    bullets: [
      "運営者は、システム保守、セキュリティ確保、外部サービスの仕様変更、天災地変その他やむを得ない事由がある場合、本サービスの全部または一部の提供を変更、停止、終了することがあります。",
      "運営者は、前項の措置によりユーザーに生じた損害について、運営者に故意または重大な過失がある場合を除き責任を負いません。",
    ],
  },
  {
    title: "第11条（免責）",
    bullets: [
      "運営者は、本サービスがユーザーの特定の目的に適合すること、期待する成果を得られること、常時安全に利用できることを保証しません。",
      "運営者は、外部サービスの提供条件の変更、停止、障害等に起因してユーザーに生じた損害について責任を負いません。",
      "ユーザー同士または第三者との間で生じた紛争は当事者間で解決するものとし、運営者に損害が生じた場合、ユーザーはこれを補償する義務を負います。",
      "本サービスの利用によりユーザーの健康状態が悪化した場合であっても、運営者に故意または重大な過失が認められない限り責任を負いません。",
    ],
  },
  {
    title: "第12条（損害賠償責任の範囲）",
    paragraphs: [
      "運営者がユーザーに対して損害賠償責任を負う場合であっても、運営者の故意または重大な過失がある場合を除き、その賠償額は当該ユーザーが直近12か月間に運営者に支払った対価の総額（無償利用の場合は金10,000円）を上限とします。",
    ],
  },
  {
    title: "第13条（外部サービスの利用）",
    bullets: [
      "ユーザーが外部サービスのアカウントを用いて本サービスにログインする場合、各外部サービスの利用規約およびプライバシーポリシーが適用されます。",
      "外部サービスの仕様変更や提供停止により本サービスの一部が利用できなくなる場合がありますが、その場合でも運営者は責任を負いません。",
    ],
  },
  {
    title: "第14条（通知および連絡）",
    bullets: [
      "運営者からユーザーへの通知は、アプリ内表示、メール、プッシュ通知、公式サイト等、運営者が適当と判断する方法で行います。",
      "ユーザーから運営者への連絡は、運営者が指定する問い合わせフォームまたはメールアドレスにより行うものとします。",
    ],
  },
  {
    title: "第15条（権利義務の譲渡等）",
    paragraphs: [
      "ユーザーは、運営者の事前の書面による承諾なく、本規約上の地位または本規約に基づく権利義務を第三者に譲渡、移転、担保設定その他処分することはできません。",
      "運営者は、本サービスに関する事業を第三者に承継させる場合、ユーザーに通知のうえ、本規約上の地位および権利義務を当該第三者に譲渡することができます。",
    ],
  },
  {
    title: "第16条（本規約の変更）",
    bullets: [
      "運営者は、必要と判断した場合、本規約を変更できます。変更後の本規約は、運営者が適切と判断する方法で告知した時点または運営者が別途定める効力発生日から適用されます。",
      "ユーザーが本規約の変更後に本サービスを利用した場合、変更後の本規約に同意したものとみなします。",
    ],
  },
  {
    title: "第17条（準拠法および裁判管轄）",
    bullets: [
      "本規約の解釈および適用は、日本法を準拠法とします。",
      "本サービスに関して運営者とユーザーの間で紛争が生じた場合、運営者の主たる事業所を管轄する日本の裁判所を第一審の専属的合意管轄裁判所とします。",
    ],
  },
  {
    title: "第18条（お問い合わせ窓口）",
    paragraphs: [
      "本サービスまたは本規約に関するお問い合わせは、以下の窓口までご連絡ください。",
      "メールアドレス: kinyoku.app.team@gmail.com",
    ],
  },
];

const PRIVACY_SECTIONS: Section[] = [
  {
    title: "1. 適用範囲",
    paragraphs: [
      "本プライバシーポリシー（以下「本ポリシー」）は、運営者が提供する本サービスにおいて、ユーザーの個人情報その他の関連情報をどのように取得・利用・管理するかを定めるものです。",
      "ユーザーが本サービスを利用する場合、本ポリシーに同意したものとみなします。",
    ],
  },
  {
    title: "2. 事業者情報",
    paragraphs: [
      "事業者名：kinyokuApp 運営チーム",
      "個人情報保護管理者：運営チーム代表（連絡先は下記お問い合わせ窓口と同じ）",
      "お問い合わせ先：kinyoku.app.team@gmail.com",
    ],
  },
  {
    title: "3. 取得する情報",
    paragraphs: [
      "運営者は、本サービスの提供に必要な範囲で、以下の情報を取得する場合があります。",
    ],
    bullets: [
      "アカウント情報：メールアドレス、パスワード（ハッシュ化値）、OAuth ログイン識別子等",
      "プロフィール情報：表示名、自己紹介、アバター画像、フォロー／ブロック状態等",
      "チャレンジ・大会関連情報：目標設定、開始・終了日時、継続日数、成功率、ランキング・大会成績、カスタムペナルティ設定等",
      "日記・コミュニティ投稿等のユーザーコンテンツ：本文、画像、コメント、リアクション、タイムスタンプ、メッセージ内容等",
      "課金・決済関連情報：購入履歴、トランザクション ID、商品 ID、決済ステータス等（クレジットカード番号等の機微情報は決済代行事業者が管理し運営者は取得しません）",
      "端末・技術情報：端末種別、OS、アプリバージョン、IP アドレス、ブラウザ種別、言語設定、ログ情報、Cookie や類似技術による識別子",
      "サポート対応に必要な情報：お問い合わせ内容、スクリーンショット等の添付資料、操作ログの一部",
    ],
  },
  {
    title: "4. 情報の取得方法",
    bullets: [
      "ユーザーがアプリやフォームに入力し送信した情報",
      "アプリの利用過程で自動的に送信される技術情報（端末情報、ログ等）",
      "決済プラットフォームや外部認証サービスから提供される情報",
      "ユーザーの同意のもと連携した外部サービスから取得する情報",
    ],
  },
  {
    title: "5. 利用目的",
    paragraphs: ["取得した情報は、以下の目的で利用します。"],
    bullets: [
      "本サービスの提供、維持、安定運用および新機能の開発",
      "チャレンジ、大会、コミュニティ投稿等の機能提供と利用履歴の記録",
      "ユーザーとの連絡、お知らせ、サポート対応、アンケートの実施",
      "本人確認、不正利用防止、セキュリティ確保、トラブル対応",
      "課金処理、購入履歴管理、領収書発行等の決済関連業務",
      "利用状況の分析、統計データの作成、サービス改善の検討",
      "法令または行政機関の要請に基づく対応",
    ],
  },
  {
    title: "6. 利用目的の変更",
    paragraphs: [
      "運営者は、前条に定める利用目的と合理的関連性を有すると認められる範囲内で、利用目的を変更することがあります。変更した場合は、適切な方法でユーザーに通知または公表します。",
    ],
  },
  {
    title: "7. 第三者提供",
    bullets: [
      "運営者は、次の場合を除き、あらかじめユーザーの同意を得ることなく個人情報を第三者に提供しません。",
      "・法令に基づく場合",
      "・人の生命、身体または財産の保護のために必要で、本人の同意を得ることが困難な場合",
      "・公衆衛生の向上または児童の健全な育成の推進に特に必要で、本人の同意を得ることが困難な場合",
      "・国または地方公共団体の機関等への協力が必要で、本人の同意取得が業務遂行に支障を及ぼすおそれがある場合",
      "・本サービスの運営に必要な範囲で、個人情報の取扱いを第三者へ委託する場合",
    ],
  },
  {
    title: "8. 委託および国外移転",
    paragraphs: [
      "運営者は、データベース、認証、分析、決済処理、メール配信等の業務を、Supabase、RevenueCat、Apple、Google、Expo などの第三者に委託することがあります。委託先とは適切な契約を締結し、必要な監督を行います。",
      "委託先のサーバーが日本国外に所在する場合があり、各国の法令に基づき開示要請を受ける可能性があります。",
    ],
  },
  {
    title: "9. 安全管理措置",
    paragraphs: [
      "運営者は、個人情報の漏えい、滅失、毀損等を防止するため、アクセス制御、暗号化、権限管理、監査ログの記録、従事者教育等、必要かつ適切な安全管理措置を講じます。",
    ],
  },
  {
    title: "10. 保管期間と消去",
    paragraphs: [
      "個人情報は、利用目的の達成に必要な期間、または法令で保存が義務付けられている期間に限り保存し、目的達成後または保存期間経過後は、速やかに適切な方法で消去または匿名化します。",
    ],
  },
  {
    title: "11. 匿名加工情報・統計情報",
    paragraphs: [
      "運営者は、個人を識別できない形式に加工した統計情報を作成し、サービス改善や調査等に利用することがあります。統計情報には個人を特定できる情報は含まれません。",
    ],
  },
  {
    title: "12. 利用者の権利",
    bullets: [
      "ユーザーは、自己に関する個人情報の開示、訂正、追加、削除、利用停止、第三者提供停止等を請求できます。",
      "請求を行う場合、運営者は本人確認を行ったうえで、合理的な期間内に対応します。ただし、法令に基づく保存義務がある情報等については、対応できない場合があります。",
      "請求内容によっては、実費相当の手数料をいただく場合があります。",
    ],
  },
  {
    title: "13. Cookie 等の利用",
    paragraphs: [
      "本サービスは、ログイン状態の保持、利便性向上、利用状況の把握のために Cookie や類似技術を利用する場合があります。ユーザーはブラウザの設定等により Cookie を無効化できますが、無効化すると本サービスの一部機能が利用できなくなることがあります。",
    ],
  },
  {
    title: "14. 未成年者の個人情報",
    paragraphs: [
      "未成年のユーザーは、必ず法定代理人の同意を得たうえで本サービスを利用してください。未成年者の個人情報について法定代理人から開示等の請求があった場合には、合理的な範囲で対応します。",
    ],
  },
  {
    title: "15. ポリシーの変更",
    paragraphs: [
      "運営者は、本ポリシーの内容を必要に応じて変更することがあります。重要な変更を行う場合は、本サービス内での告知やメール配信等、運営者が適切と判断する方法で通知します。変更後にユーザーが本サービスを利用した場合、変更後の本ポリシーに同意したものとみなします。",
    ],
  },
  {
    title: "16. お問い合わせ窓口",
    paragraphs: [
      "本ポリシーおよび個人情報の取扱いに関するお問い合わせ、相談、開示等のご請求は、以下の窓口までご連絡ください。",
      "メールアドレス: kinyoku.app.team@gmail.com",
    ],
  },
];

const LegalContent: React.FC<Props> = ({ type, lastUpdated }) => {
  const { mode } = useAppTheme();
  const styles = useMemo(() => createStyles(mode), [mode]);
  const sections = type === "terms" ? TERMS_SECTIONS : PRIVACY_SECTIONS;

  return (
    <View>
      <Text style={styles.updated}>
        最終更新日: {lastUpdated || LAST_UPDATED_DEFAULT}
      </Text>
      {sections.map((section) => (
        <View key={section.title} style={styles.section}>
          <Text style={styles.sectionTitle}>{section.title}</Text>
          <View style={styles.sectionBody}>
            {section.paragraphs?.map((paragraph) => (
              <Text key={paragraph} style={styles.p}>
                {paragraph}
              </Text>
            ))}
            {section.bullets?.map((bullet) => (
              <Text key={bullet} style={styles.li}>
                ・{bullet}
              </Text>
            ))}
          </View>
        </View>
      ))}
    </View>
  );
};

const createStyles = (mode: "light" | "dark") => {
  const { colorSchemes } = require("@shared/theme/colors");
  const colors = colorSchemes[mode];
  return StyleSheet.create({
    section: { marginBottom: spacing.xl },
    sectionTitle: {
      fontSize: typography.fontSize.lg,
      fontWeight: "700",
      color: colors.textPrimary,
      marginBottom: spacing.sm,
    },
    sectionBody: {},
    p: { color: colors.textPrimary, lineHeight: 22, marginBottom: spacing.xs },
    li: {
      color: colors.textPrimary,
      lineHeight: 22,
      marginLeft: spacing.md,
      marginBottom: spacing.xs,
    },
    updated: { color: colors.textSecondary, marginBottom: spacing.lg },
  });
};

export default LegalContent;
