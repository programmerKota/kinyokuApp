FROM node:18-bullseye

RUN apt-get update \
    && apt-get install -y cron \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /workspace

# Install crontab
COPY cron/batch-crontab /etc/cron.d/batch-crontab
RUN chmod 0644 /etc/cron.d/batch-crontab \
    && crontab /etc/cron.d/batch-crontab || (echo "using /etc/cron.d" && true)

# Keep cron in foreground
CMD ["sh", "-lc", "cron && tail -f /var/log/cron.log || cron -f"]

